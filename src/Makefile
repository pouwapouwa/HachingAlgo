CPPFLAGS = -I. -I../include
CFLAGS = -Wall -Wextra -O3 -std=c99
LDFLAGS = -lm
EXE = MD5 SHA1 SHA3
TESTEXE = MD5_test SHA1_test
OBJ = md5.o display.o sha1.o sha3.o 
TESTOBJS =
INCDIR = ../include

.PHONY: all clean help

all: $(EXE)

MD5: md5.o display.o
	$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)

SHA1: sha1.o display.o
	$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)

SHA3: sha3.o display.o
	$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)

test: $(EXE)
	./test.sh

$(TESTEXE):
	$(TESTOBJS) $(CC) $(CFLAGS) $(CPPFLAGS) -o $@ $^ $(LDFLAGS)

md5.o: md5.c $(INCDIR)/MD5.h $(INCDIR)/display.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c -o $@ $<

display.o: display.c $(INCDIR)/display.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c -o $@ $<

sha1.o:sha1.c $(INCDIR)/display.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -DSHA1TEST -c -o $@ $<

sha3.o:sha3.c $(INCDIR)/display.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c -o $@ $<

clean:
	@(rm -rf *~ *.o *.gcov *.gcda *.gcno $(EXE) $(TESTEXE))

help:
	@(echo -e "Makefile usage :")
	@(echo -e "  make [all]\t\tBuild the haching algorithm software")
	@(echo -e "  make clean\t\tRemove all files generated by make")
	@(echo -e "  make test\t\tEnsure that shasum and md5sum give the same results as our algorithms")
	@(echo -e "  make help\t\tDisplay this help")
